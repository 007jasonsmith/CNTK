WorkDir=.
ModelDir=$WorkDir$/_out/$ConfigName$
stderr=$WorkDir$/_out/$ConfigName$

ndlMacros=$WorkDir$/Macros.ndl

precision=float
deviceId=Auto

command=Train:AddBNEval:Test

Train=[
    action=train
    modelPath=$ModelDir$/03_ConvBatchNorm

     NDLNetworkBuilder=[
        networkDescription=$WorkDir$/03_ConvBatchNorm.ndl
    ]
    
    SGD=[
        epochSize=60000
        minibatchSize=32
        learningRatesPerMB=0.5
        momentumPerMB=0*10:0.7
        maxEpochs=8
    ]
    
    reader=[
        readerType=UCIFastReader
        file=$WorkDir$/Train-28x28.txt
        features=[
            dim=784
            start=1
        ]
        labels=[
            dim=1
            start=0
            labelDim=10
            labelMappingFile=$WorkDir$/labelsmap.txt
        ]
    ]    
]

AddBNEval=[    
    action=edit
    CurModel=$ModelDir$/03_ConvBatchNorm
    NewModel=$ModelDir$/03_ConvBatchNorm.Eval
    editPath=$WorkDir$/03_ConvBatchNorm.mel
]

Test=[
    action=test
    minibatchSize=512
    modelPath=$ModelDir$/03_ConvBatchNorm.Eval

     NDLNetworkBuilder=[
        networkDescription=$WorkDir$/03_ConvBatchNorm.ndl
    ]
    
    reader=[
        readerType=UCIFastReader
        file=$WorkDir$/Test-28x28.txt
        features=[
            dim=784
            start=1
        ]
        labels=[
            dim=1
            start=0
            labelDim=10
            labelMappingFile=$WorkDir$/labelsmap.txt
        ]
    ]    
]
